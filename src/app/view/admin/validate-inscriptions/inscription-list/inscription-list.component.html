<div class="p-grid">
    <div class="p-col-12">

        <p-toast></p-toast>


        <div class="card" style="background-color: gainsboro">

            <p-toolbar styleClass="p-mb-4">

                <ng-template pTemplate="left">
                    <button (click)="deleteMultiple()" [disabled]="!selectes || !selectes.length"
                            class="p-button-danger p-mb-2" icon="pi pi-trash" label="Delete"
                            pButton pRipple></button>
                </ng-template>

                <ng-template pTemplate="right">
                    <p-fileUpload [maxFileSize]="1000000" accept="image/*" chooseLabel="Import"
                                  class="p-mr-2 p-mb-2 p-d-inline-block"
                                  label="Import" mode="basic"></p-fileUpload>
                    <button (click)="dt.exportCSV()" class="p-button-info p-mb-2" icon="pi pi-upload" label="Export"
                            pButton
                            pRipple></button>
                </ng-template>
            </p-toolbar>
            <div class="card">
                <h5>Manage Inscriptions </h5>
                <p-tabView (onChange)="handleChange($event)">
                    <p-tabPanel header="All inscription">
                        <p-table #dt [(selection)]="selectes" [columns]="cols"
                                 [globalFilterFields]="['numeroInscription','datedebutinscription','datefininscription' , 'nom', 'prenom' , 'prof' , 'etatInscription']"
                                 [paginator]="true"
                                 [rowHover]="true"
                                 [rows]="6" [showCurrentPageReport]="true" [value]="this.items"
                                 currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                                 dataKey="id"
                                 styleClass="p-datatable-customers">
                            <ng-template pTemplate="caption">
                                <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                                    <div class="p-col"><br>
                                        <span>
                                     <input [(ngModel)]="student.nom" pInputText
                                            placeholder="Search by LastName"
                                            style="margin-right: 10px;width: 200px"
                                            type="text"/>
                                     <input [(ngModel)]="student.prenom  " pInputText
                                            placeholder="Search by FirstName"
                                            style="margin-right: 10px;width: 200px"
                                            type="text"/>
                                    <input [(ngModel)]="student.username " pInputText
                                           placeholder="Search by UserName"
                                           style="margin-right: 10px;width: 200px"
                                           type="text"/>

                           <button pButton pRipple type="button" icon="pi pi-search" (click)="findByCriteria()"
                                   style="margin-left: 25px"
                                   class="p-button-rounded p-button-success"></button>
                            </span>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 3rem">
                                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                                    </th>
                                    <th pSortableColumn="id">Phone
                                        <p-sortIcon field="id"></p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">Full Name
                                        <p-sortIcon field="nom"></p-sortIcon>
                                    </th>

                                    <th pSortableColumn="prenom">E-mail
                                        <p-sortIcon field="prenom"></p-sortIcon>
                                    </th>
                                    <th></th>

                                    <th pSortableColumn="mail">Date
                                        <p-sortIcon field="mail"></p-sortIcon>
                                    </th>
                                    <th>Status</th>
<!--                                    <th>View Details</th>-->
<!--                                    <th>Delete Registration</th>-->
                                    <th> Action</th>

                                </tr>
                            </ng-template>
                            <ng-template let-inscription pTemplate="body">
                                <tr>
                                    <td>
                                        <p-tableCheckbox [value]="inscription"></p-tableCheckbox>
                                    </td>
                                    <td>{{inscription.etudiant.numero}}</td>
                                    <td>{{inscription.etudiant.nom}} {{inscription.etudiant.prenom}}</td>
                                    <td>{{inscription.etudiant.username}}</td>
                                    <td></td>
                                    <td> {{inscription.dateRegistration}} </td>
                                    <td>
                                        <span *ngIf="inscription.etatInscription.libelle == 'Validated'" class="badge-v">VALIDATED</span>
                                        <span *ngIf="inscription.etatInscription.libelle !== 'Validated'" class="badge-nv">Pending</span>
                                    </td>

                                    <td>
                                        <button (click)="view(inscription)"
                                                class="p-button-rounded p-button-info p-mr-2" icon="pi pi-list" pButton
                                                pRipple></button>
                                        <button (click)="showEditDialog(inscription)"
                                                class="p-button-rounded p-button-success p-mr-2" icon="pi pi-pencil" pButton
                                                pRipple></button>

                                        <button  (click)="delete(inscription)" class="p-button-rounded p-button-danger"
                                                 icon="pi pi-trash" pButton
                                                 pRipple></button>
                                    </td>

<!--                                    <td>-->
<!--                                        <button  class="p-button-info " label="details" pButton-->
<!--                                                pRipple></button>-->
<!--                                    </td>-->
<!--                                    <td>-->
<!--                                        <button class="p-button-danger" label="delete" pButton-->
<!--                                                pRipple></button>-->
<!--                                    </td>-->


                                </tr>
                            </ng-template>
                            <ng-template pTemplate="summary">
                                <div class="p-d-flex p-ai-center p-jc-between">
                                    In total there are {{items ? items.length : 0 }} items.
                                </div>
                            </ng-template>
                        </p-table>

                    </p-tabPanel>
                    <p-tabPanel header="Pending inscription">
                        <p-table #dt [(selection)]="selectes" [columns]="cols"
                                 [globalFilterFields]="['numeroInscription','datedebutinscription','datefininscription' , 'nom', 'prenom' , 'prof' , 'etatInscription']"
                                 [paginator]="true"
                                 [rowHover]="true"
                                 [rows]="6" [showCurrentPageReport]="true" [value]="this.items"
                                 currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                                 dataKey="id"
                                 styleClass="p-datatable-customers">
                            <ng-template pTemplate="caption">
                                <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                                    <div class="p-col"><br>
                                        <span>
                                     <input [(ngModel)]="student.nom" pInputText
                                            placeholder="Search by LastName"
                                            style="margin-right: 10px;width: 200px"
                                            type="text"/>
                                     <input [(ngModel)]="student.prenom  " pInputText
                                            placeholder="Search by FirstName"
                                            style="margin-right: 10px;width: 200px"
                                            type="text"/>
                                    <input [(ngModel)]="student.username " pInputText
                                           placeholder="Search by UserName"
                                           style="margin-right: 10px;width: 200px"
                                           type="text"/>

                           <button pButton pRipple type="button" icon="pi pi-search" (click)="findByCriteria()"
                                   style="margin-left: 25px"
                                   class="p-button-rounded p-button-success"></button>
                            </span>
                                    </div>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 3rem">
                                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                                    </th>
                                    <th pSortableColumn="id">Phone
                                        <p-sortIcon field="id"></p-sortIcon>
                                    </th>
                                    <th pSortableColumn="nom">Full Name
                                        <p-sortIcon field="nom"></p-sortIcon>
                                    </th>

                                    <th pSortableColumn="prenom">E-mail
                                        <p-sortIcon field="prenom"></p-sortIcon>
                                    </th>
                                    <th></th>

                                    <th pSortableColumn="mail">Date
                                        <p-sortIcon field="mail"></p-sortIcon>
                                    </th>
                                    <th>Status</th>
                                    <th>View Details</th>
                                    <th>Delete Registration</th>

                                </tr>
                            </ng-template>
                            <ng-template let-inscription pTemplate="body">
                                <tr>
                                    <td>
                                        <p-tableCheckbox [value]="inscription"></p-tableCheckbox>
                                    </td>
                                    <td>{{inscription.etudiant.numero}}</td>
                                    <td>{{inscription.etudiant.nom}} {{inscription.etudiant.prenom}}</td>
                                    <td>{{inscription.etudiant.username}}</td>
                                    <td></td>
                                    <td> {{inscription.dateRegistration}} </td>
                                    <td>
                                        <span *ngIf="inscription.etatInscription.libelle == 'Validated'" class="badge-v">VALIDATED</span>
                                        <span *ngIf="inscription.etatInscription.libelle !== 'Validated'" class="badge-nv">Pending</span>
                                    </td>
                                    <td>
                                        <button (click)="view(inscription)" class="p-button-info " label="details" pButton
                                                pRipple></button>
                                    </td>
                                    <td>
                                        <button (click)="delete(inscription)" class="p-button-danger" label="delete" pButton
                                                pRipple></button>
                                    </td>


                                </tr>
                            </ng-template>
                            <ng-template pTemplate="summary">
                                <div class="p-d-flex p-ai-center p-jc-between">
                                    In total there are {{items ? items.length : 0 }} items.
                                </div>
                            </ng-template>
                        </p-table>

                    </p-tabPanel>
                </p-tabView>
            </div>


        </div>


        <app-inscription-create></app-inscription-create>

        <app-inscription-edit></app-inscription-edit>

        <app-inscription-view></app-inscription-view>
    </div>
</div>


<!------------------------ edit inscription Dialog -------------------------------------------------->



<p-dialog header="Registration Details" [(visible)]="editInscDialog" [style]="{width: '70vw'}">
    <div style="margin-bottom: 10px;">
        <i style="color: red ; font-weight: bold">*</i> Required fields
    </div>
<form  [formGroup]="exform" >
    <div class="p-grid">


        <div class="p-col-4">
            <span class="p-float-label" style="margin-top: 10px;">
                 <input  formControlName="fullName" type="text" pInputText [(ngModel)]="inscription.etudiant.prenom" ><i style="color: red">*</i>
                <label >Full name</label>
            </span>
            <small style="font-weight: bold" *ngIf="exform.get('fullName').invalid && exform.get('fullName').touched"
                   class="text-danger">Full name is Required</small>
        </div>



        <!--        <div class="p-col-4">-->
        <!--            <span class="p-float-label">-->
        <!--                 <input  disabled type="text" pInputText [(ngModel)]="inscription.prof"><label-->
        <!--            >Teacher</label>-->
        <!--            </span>-->
        <!--        </div>-->


        <div class="p-col-4">
            <span class="p-float-label" style="margin-top: 10px;">
                 <p-dropdown editable="true"   class="form-control"  [options]="parcours" [(ngModel)]="inscription.parcours"   formControlName="level" optionLabel="libelle"></p-dropdown>
                <i style="color: red">*</i>
                 <label>Level</label>
            </span>
            <small style="font-weight: bold" *ngIf="exform.get('level').invalid && exform.get('level').touched"
                   class="text-danger">Level is Required</small>
        </div>


        <div class="p-col-4">
            <span class="p-float-label" style="margin-top: 15px;">
                 <p-dropdown  editable="true"  class="form-control" formControlName="state" [options]="etatInsc" [(ngModel)]="inscription.etatInscription"  optionLabel="libelle"></p-dropdown>
                <i style="color: red">*</i>
                 <label>State</label>
            </span>
            <small style="font-weight: bold" *ngIf="exform.get('state').invalid && exform.get('state').touched"
                   class="text-danger">State is required</small>
        </div>

        <div class="p-col-4">
            <span class="p-float-label" style="margin-top: 15px;">
                 <p-dropdown editable="true" formControlName="groupeEtude" [options]="groupEtudes"
                             [(ngModel)]="inscription.groupeEtude"  class="form-control" optionLabel="libelle"></p-dropdown><i style="color: red">*</i>
                 <label>Group option</label>
            </span>
            <small style="font-weight: bold" *ngIf="exform.get('groupeEtude').invalid && exform.get('groupeEtude').touched"
                   class="text-danger">Group option is Required</small>
        </div>
        <div class="p-col-4">
            <span class="p-float-label" style="margin-top: 15px;">
                 <p-dropdown editable="true" class="form-control" formControlName="packOption" (click)="findTypeOfPack(inscription)" [options]="packStudents" [(ngModel)]="inscription.packStudent" optionLabel="libelle"></p-dropdown><i style="color: red">*</i>
                <label>Pack option</label>
            </span>
            <small style="font-weight: bold" *ngIf="exform.get('packOption').invalid && exform.get('packOption').touched"
                   class="text-danger">Pack is Required</small>
        </div>




        <div class="p-col-4">
            <span class="p-float-label" style="margin-top: 15px;">
          <p-calendar [ngModelOptions]="{standalone: true}" id="start" [(ngModel)]="inscription.datedebutinscription"
                      [showTime]="true" name="StartTime"
                       class="e-field"
                       data-name="startTime"
                       [showIcon]="true"
                       inputId="start"></p-calendar> <label> Start date</label>
            </span>
        </div>

        <div class="p-col-4">
            <span class="p-float-label"style="margin-top: 15px;">
          <p-calendar id="finish" [ngModelOptions]="{standalone: true}" [(ngModel)]="inscription.datefininscription" [showTime]="true" name="finishDate"
                      class="e-field"
                      data-name="startTime"
                      [showIcon]="true"
                      inputId="start"></p-calendar> <label> Finish date</label>
            </span>

        </div>


        <div class="p-col-12 p-md-6 p-lg-4">
             <span class="p-float-label" style="margin-top: 15px;">
            <p-dropdown editable="true"  [ngModelOptions]="{standalone: true}" [options]="statutSocials" [(ngModel)]="inscription.statutSocial"
                        optionLabel="libelle" [itemSize]="3"></p-dropdown><label>  Status Social</label>
             </span>

        </div>

        <div class="p-col-12 p-md-6 p-lg-4">
                         <span class="p-float-label" style="margin-top: 15px;">

            <p-dropdown [options]="fonctions"  [(ngModel)]="inscription.fonction"
                        editable="true"   [ngModelOptions]="{standalone: true}"  optionLabel="libelle" [itemSize]="3"></p-dropdown>
                             <label> Area of work</label>
                         </span>

        </div>

        <div class="p-col-12 p-md-6 p-lg-4">
                        <span class="p-float-label" style="margin-top: 15px;">

            <p-dropdown editable="true"  [options]="niveauEtudes" [(ngModel)]="inscription.niveauEtude"
                        [ngModelOptions]="{standalone: true}"  optionLabel="libelle" [itemSize]="3"></p-dropdown>
                            <label >Study Level</label>
                        </span>

        </div>
        <div class="p-col-12 p-md-6 p-lg-4">
                        <span class="p-float-label" style="margin-top: 15px;">
            <p-dropdown editable="true"  formControlName="interet"  [options]="interetEtudiants" [(ngModel)]="inscription.interetEtudiant"
                        optionLabel="libelle" [itemSize]="3"></p-dropdown>
                            <label>Main goal with learning english</label>
                        </span>

        </div>
        <div class="p-col-12 p-md-6 p-lg-4">
   <span class="p-float-label"  style="margin-top: 15px;">
            <p-dropdown   [ngModelOptions]="{standalone: true}"editable="true" [options]="skills" [(ngModel)]="inscription.skill"
                        optionLabel="libelle" [itemSize]="3" ></p-dropdown>
   <label>Skill</label>

   </span>
        </div>
    </div>
</form>
    <ng-template pTemplate="footer">
        <button pButton pRipple type="button" icon="pi pi-save" label="save changes"
                (click)="updateInsc(inscription) "
                class="p-button-raised-primary"></button>
    </ng-template>
</p-dialog>
