<div *ngIf="showTakeQuiz" class="p-field">
    <div class="p-grid" style="background-color: white;">
        <div style="text-align: start;" class="p-col-4">
            <div style="font-size: medium;font-weight: 600;">
                {{question?.typeDeQuestion?.lib}}
            </div>
        </div>
        <div class="p-col-4" style="text-align:center">
            <p-button *ngIf="participants.get(login.getConnectedProf().id)?.length !== 1"
                      label="Answers"
                      (click)="op.toggle($event)"
                      styleClass="p-button-secondary  p-button-rounded"
                      [badge]="grpStudentAnswers.size.toString()"
                      badgeClass="p-badge-success">
            </p-button>
            <p-overlayPanel #op [style]="{width: '700px' ,  backgroundColor:' #f8f9fa'}"
                            [showTransitionOptions]="'0ms'" [hideTransitionOptions]="'0ms'" [dismissable]="true"
                            [showCloseIcon]="false">
                <ng-template pTemplate>
                    <p-table [value]="grpStudentAnswers | keyvalue" [scrollable]="true" scrollHeight="400px">
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="min-width:200px">Full Name</th>
                                <th style="min-width:200px">Answers</th>
                                <th style="min-width:200px">Status</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-answer>
                            <tr>
                                <td>{{answer.key?.nom }} {{ answer.key?.prenom}}</td>
                                <td>{{answer.value?.lib}}</td>
                                <td>{{answer.value?.etatReponse}}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </ng-template>
            </p-overlayPanel>
        </div>

        <div class="p-col-4" style="text-align: end">{{question.numero}}
            /{{numberOfQuestion}}
        </div>

    </div>

    <div class="p-grid">
        <div style="  background-color: transparent!important;" class="p-col-12">
            <p-progressBar [style]="{'height': '6px'}" [showValue]="false"
                           [value]="value"></p-progressBar>
        </div>
        <!--        <div class="p-col-12">-->
        <!--            <input  type="text"-->
        <!--                   [(ngModel)]="test" pInputText>-->
        <!--            <button  pButton pRipple type="button"-->
        <!--                    icon="pi pi-check" iconPos="right"-->
        <!--                    label="Test" class="p-button-raised check-button "-->
        <!--                    (click)="sendWebSocket(test)">-->
        <!--            </button>-->
        <!--        </div>-->
    </div>

    <!--------------------------------- UNIQUE CHOICE-------------------------------------------------------->

    <div *ngIf="question.typeDeQuestion.ref === 't1'" class="p-grid">
        <div class="p-col-12 question">
            <button pButton pRipple type="button" (click)="sound(question)"
                    icon="pi pi-volume-up" class="p-button-rounded sonButton "></button>
            <h5 class="h5"> {{  questionSideLeft}}  </h5>
            <span class="p-float-label">
            <input *ngIf="answerSelected.lib === undefined" id="inputDashedBorder" inputId="inputDashedBorder"
                   type="text"
                   [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"
                   [(ngModel)]="reponseQuiz.lib"
                   (ngModelChange)="saveAnswers(question)"
                   class="p-inputtext-sm " pInputText/>

            <input *ngIf="answerSelected.lib !== undefined && answerIsCorrect(answerSelected, question) " disabled
                   id="inputCorrectAnswer" inputId="inputDashedBorder" type="text"
                   [(ngModel)]="answerSelected.lib"
                   class="p-inputtext-sm " pInputText/>

            <input *ngIf="answerSelected.lib !== undefined && !answerIsCorrect(answerSelected, question)" disabled
                   id="inputFalseAnswer" inputId="inputDashedBorder" type="text"
                   [(ngModel)]="answerSelected.lib"
                   class="p-inputtext-sm " pInputText/>

        </span>
            <h5 class="h5"> {{  questionSideRight}}  </h5>
            <h4 *ngIf="translateWord !== undefined">{{translateWord}}</h4>
        </div>
        <div class="p-col-12 answers">
            <div *ngFor="let reponse of question?.reponses" class="p-field-checkbox textQuestion">
                <p-radioButton [inputId]="reponse.lib" name="category" [(ngModel)]="reponseQuiz.lib"
                               (onClick)="showDontKnowButton = false; showCheckButton = true"
                               [value]="reponse.lib"></p-radioButton>
                <label [for]="reponse.lib">{{reponse.lib}}</label>
            </div>
            <button *ngIf="showCheckButton && !saveDone" pButton pRipple type="button"
                    icon="pi pi-check" iconPos="right"
                    label="Send answer" class="p-button-raised check-button "
                    (click)="saveAnswers(question)">
            </button>
        </div>
    </div>


    <!--------------------------------- TRANSLATE THE PHRASE -------------------------------------------------------->


    <div *ngIf="question.typeDeQuestion.ref === 't3'" class="p-grid">
        <div class="p-col-12 question">
            <h5 style="margin-top: -20px;" class="translateQuestion"> {{  question?.libelle}}  </h5>

            <span style="margin: 0" class="p-float-label">
            <button *ngIf="answerSelected.lib !== undefined"
                    pButton pRipple type="button" (click)="sound(question)"
                    icon="pi pi-volume-up" class="p-button-rounded sonButton ">
            </button>

            <input *ngIf="answerSelected.lib === undefined" id="input-answer" type="text"
                   [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"
                   (focus)="showDontKnowButton = false ; showCheckButton=true"
                   [(ngModel)]="reponseQuiz.lib" pInputText>

            <input disabled *ngIf="answerSelected.lib !== undefined && answerIsCorrect(answerSelected, question)"
                   id="input-answer-correct" type="text"
                   [(ngModel)]="answerSelected.lib" pInputText>

            <input style="text-decoration: 2px line-through red;" disabled
                   *ngIf="answerSelected.lib !== undefined && !answerIsCorrect(answerSelected, question)"
                   [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"
                   id="input-answer-incorrect" type="text"
                   [(ngModel)]="answerSelected.lib" pInputText>
        </span>
            <h4 *ngIf="translateWord !== undefined">{{translateWord}}</h4>


        </div>

        <div class="p-col-12 answers">

            <button *ngIf="showCheckButton && !saveDone" pButton pRipple type="button"
                    icon="pi pi-check" iconPos="right"
                    label="Send answer" class="p-button-raised check-button "
                    (click)="saveAnswers(question)">
            </button>

        </div>
    </div>


    <!--------------------------------- CORRECT THE MISTAKE -------------------------------------------------------->

    <div *ngIf="question.typeDeQuestion.ref === 't4'" class="p-grid">
        <div class="p-col-12 question">
            <button pButton pRipple type="button" (click)="sound(question)"
                    icon="pi pi-volume-up" class="p-button-rounded sonButton "></button>
            <h5 class="h5"> {{  questionSideLeft}}  </h5>
            <span class="p-float-label">
                <input style="font-weight: normal;" *ngIf="answerSelected.lib === undefined" id="inputQstT4"
                       (focus)="showDontKnowButton =false; showCheckButton=true;"
                       [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"

                       (focusin)="hidePlaceHolder('HIDE')"
                       (focusout)="hidePlaceHolder('SHOW')"
                       inputId="inputDashedBorder" type="text"
                       [placeholder]="inputAnswer"
                       [(ngModel)]="reponseQuiz.lib" class="p-inputtext-sm " pInputText/>


            <input *ngIf="answerSelected.lib !== undefined && answerIsCorrect(answerSelected, question) " disabled
                   id="inputCorrectAnswer" inputId="inputDashedBorder" type="text"
                   [(ngModel)]="answerSelected.lib"
                   class="p-inputtext-sm " pInputText/>

            <input *ngIf="answerSelected.lib !== undefined && !answerIsCorrect(answerSelected, question)" disabled
                   id="inputFalseAnswer" inputId="inputDashedBorder" type="text"
                   [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"
                   [(ngModel)]="answerSelected.lib"
                   class="p-inputtext-sm " pInputText/>


        </span>
            <h5 class="h5"> {{  questionSideRight}}  </h5>
            <h4 *ngIf="translateWord !== undefined">{{translateWord}}</h4>
        </div>
        <div class="p-col-12 answers">
            <button *ngIf="showCheckButton && !saveDone" pButton pRipple type="button"
                    icon="pi pi-check" iconPos="right"
                    label="Send answer" class="p-button-raised check-button "
                    (click)="saveAnswers(question)">
            </button>
        </div>
    </div>


    <!--------------------------------- WRITE  THE CORRECT FORM -------------------------------------------------------->

    <div *ngIf="question.typeDeQuestion.ref === 't6'" class="p-grid">
        <div class="p-col-12 question">
            <button pButton pRipple type="button" (click)="sound(question)"
                    icon="pi pi-volume-up" class="p-button-rounded sonButton "></button>
            <h5 class="h5"> {{  questionSideLeft}}  </h5>
            <span class="p-float-label">
                <input style="font-weight: normal;" *ngIf="answerSelected.lib === undefined" id="inputQstT4"
                       (focus)="showDontKnowButton =false; showCheckButton=true;"
                       (focusin)="hidePlaceHolder('HIDE')"
                       (focusout)="hidePlaceHolder('SHOW')"
                       [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"
                       inputId="inputDashedBorder" type="text"
                       [placeholder]="inputAnswer"
                       [(ngModel)]="reponseQuiz.lib" class="p-inputtext-sm " pInputText/>


            <input *ngIf="answerSelected.lib !== undefined && answerIsCorrect(answerSelected, question) " disabled
                   id="inputCorrectAnswer" inputId="inputDashedBorder" type="text"
                   [(ngModel)]="answerSelected.lib"
                   class="p-inputtext-sm " pInputText/>

            <input *ngIf="answerSelected.lib !== undefined && !answerIsCorrect(answerSelected, question)" disabled
                   id="inputFalseAnswer" inputId="inputDashedBorder" type="text"
                   [(ngModel)]="answerSelected.lib"
                   class="p-inputtext-sm " pInputText/>


        </span>
            <h5 class="h5"> {{  questionSideRight}}  </h5>
            <h4 *ngIf="translateWord !== undefined">{{translateWord}}</h4>
        </div>
        <div class="p-col-12 answers">
            <button *ngIf="showCheckButton && !saveDone" pButton pRipple type="button"
                    icon="pi pi-check" iconPos="right"
                    label="Send answer" class="p-button-raised check-button "
                    (click)="saveAnswers(question)">
            </button>
        </div>
    </div>


    <!--------------------------------- TRUE OR FALSE -------------------------------------------------------->

    <div *ngIf="question.typeDeQuestion.ref === 't5'" class="p-grid">
        <div class="p-col-12  question ">
            <div id="trueFalse" class="p-grid trueOrFalseQst">
                <div class="p-col-9">
                    {{  question?.libelle}}
                </div>
                <div style="padding-top: 2%;" class="p-col-3">
                    <p-toggleButton [(ngModel)]="trueOrFalse" onLabel="True"
                                    id="toggleButton"
                                    [disabled]="disableToggleButton"
                                    (ngModelChange)="showCheckButton=true; showDontKnowButton=false"
                                    [pTooltip]="correctAnswersList.get(question.id)[0]?.lib" tooltipPosition="top"
                                    offLabel="False" onIcon="pi pi-check"
                                    offIcon="pi pi-times"
                                    [style]="{'width': '7em',
                                 'height': '23px'
                                 }">
                    </p-toggleButton>
                </div>
            </div>
        </div>
        <div style="text-align: center!important;" class="p-col-12">
            <h4 *ngIf="translateWord !== undefined">{{translateWord}}</h4>

        </div>

        <div class="p-col-12 answers">

            <button *ngIf="showCheckButton && !saveDone" pButton pRipple type="button"
                    icon="pi pi-check" iconPos="right"
                    label="Send answer" class="p-button-raised check-button "
                    (click)="saveAnswers(question)">
            </button>
        </div>
    </div>


    <!--------------------------------- WORD BY WORD -------------------------------------------------------->

    <div style="background-color: white;" *ngIf="question.typeDeQuestion.ref === 't12'"
         class="p-grid">
        <div class="p-col-12 question">
            <button [disabled]="disableButtonSon" pButton pRipple type="button"
                    (click)="sound(question)"
                    icon="pi pi-volume-up" class="p-button-rounded sonButton "></button>

            <h5 class="h5 libelleT12" [id]="item.key"
                [pTooltip]="getCorrectAnswerForT12()" tooltipPosition="top"
                *ngFor="let item of answersT12List| keyvalue">{{item.value}} </h5>
        </div>
        <div *ngIf="showT12AnswerDiv" class="p-col-12 correctAnswerT12">
            {{correctAnswerT12}}
        </div>

        <div [id]="value.lib" *ngFor="let value of t12AnswersList"
             (click)="checkAnswers(value)"
             class="p-col-3 answert12">
            {{value.lib}}

        </div>

    </div>


    <div class="p-grid sideBar">
        <div class="p-col-3">
            <button *ngIf="question.id !== questionList[0]?.id"
                    style="float:left"
                    pButton pRipple
                    type="button" icon="pi pi-arrow-left" iconPos="left"
                    label="Previous" (click)="previousQuestionFct()"
                    class="p-button-rounded p-button-secondary"></button>
        </div>

        <div style="text-align: center" class="p-col-6">

            <!--            <button *ngIf="question.id !== questionList[0]?.id && showFollowButton"-->
            <!--                    pButton pRipple-->
            <!--                    type="button" icon="pi pi-arrow-down" iconPos="right"-->
            <!--                    label="Follow me" (click)="followMeFct(question)"-->
            <!--                    class="p-button-rounded p-button-info"></button>-->
        </div>

        <div class="p-col-3">
            <button *ngIf="question.id !== questionList[questionList.length -1]?.id"
                    style="float:right"
                    pButton pRipple
                    type="button" icon="pi pi-arrow-right" iconPos="right"
                    label="Next" (click)="nextQuestionFct()"
                    class="p-button-rounded p-button-secondary"></button>


            <button *ngIf="question.id === questionList[questionList.length -1]?.id " style="float:right" pButton
                    pRipple
                    (click)="finishQuiz()"
                    type="button" icon="pi pi-question" iconPos="right"
                    label="Result"
                    class="p-button-rounded p-button-info"></button>
        </div>
    </div>
</div>

<div *ngIf="showQuizReview" class="card">
    <p-table [value]="reponseQuizList" styleClass="p-datatable-striped">
        <ng-template pTemplate="header">
            <tr>
                <th>Student name</th>
                <th>Result</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-reponse>
            <tr>
                <td>{{reponse?.etudiant?.nom }} {{ reponse?.etudiant?.prenom}}</td>
                <td>{{reponse?.resultat}}</td>
                <td>
                    <button pButton pRipple type="button" icon="pi pi-info"
                            (click)="showDetails(reponse)"
                            class="p-button-rounded p-button-warning">
                    </button>

                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog [header]="listAnswers[0]?.quizEtudiant?.etudiant?.nom + ' ' + listAnswers[0]?.quizEtudiant?.etudiant?.prenom"
          [(visible)]="display" [style]="{width: '80vw'}">
    <p-table [value]="listAnswers" styleClass="p-datatable-striped">
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 20px;"></th>
                <th style="width: 20px;"></th>
                <th>Question type</th>
                <th>Student answer</th>
                <th>Correct answer</th>
                <th>Note</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-answer>
            <tr>
                <th scope="row" *ngIf="answer.answer === answer?.reponse?.lib && answer.note !== 0.5 ">
                    <i class="pi pi-check-circle" pTooltip="Correct answer" tooltipPosition="top"></i>
                </th>

                <th scope="row" *ngIf="answer.answer !== answer.reponse.lib && answer.answer !== null || undefined">
                    <i pTooltip="Incorrect answer" tooltipPosition="top" class="pi pi-times-circle"></i></th>

                <th scope="row" *ngIf="answer.note === 0.5">
                    <i pTooltip="Professor is answered" tooltipPosition="top" class="pi pi-users"></i>
                </th>

                <th scope="row" *ngIf="answer.answer === null || undefined">
                    <i pTooltip="Student don't know" tooltipPosition="top" class="pi pi-exclamation-circle"></i>
                </th>

                <th scope="row">{{answer?.question?.numero}}</th>
                <td>{{answer?.question?.typeDeQuestion?.lib}}</td>
                <td>{{answer?.answer}}</td>
                <td>{{answer?.reponse?.lib}}</td>
                <td>{{answer?.note}}</td>
            </tr>
        </ng-template>
    </p-table>
</p-dialog>
