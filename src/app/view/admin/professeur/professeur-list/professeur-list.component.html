<div class="p-grid">
    <div class="p-col-12" [hidden]="!scheduleDialog">

        <p-toast></p-toast>

        <div class="card" style="background-color: gainsboro">
            <p-toolbar styleClass="p-mb-4">
                <ng-template pTemplate="left">
                    <button (click)="openCreate()" class="p-button-success p-mr-2 p-mb-2" icon="pi pi-plus" label="New"
                            pButton
                            pRipple style="width: 90px"></button>
                    <button (click)="deleteMultiple()" [disabled]="!selectes || !selectes.length"
                            class="p-button-danger p-mb-2" icon="pi pi-trash" label="Delete"
                            pButton pRipple></button>
                </ng-template>

                <ng-template pTemplate="right">
                    <p-fileUpload [maxFileSize]="1000000" accept="image/*" chooseLabel="Import"
                                  class="p-mr-2 p-mb-2 p-d-inline-block"
                                  label="Import" mode="basic"></p-fileUpload>
                    <button (click)="dt.exportCSV()" class="p-button-info p-mb-2" icon="pi pi-upload" label="Export"
                            pButton
                            pRipple></button>
                </ng-template>
            </p-toolbar>

            <p-table #dt [(selection)]="selectes" [columns]="cols"
                     [globalFilterFields]="['reference','total','totalPaye','firstName','lastName','phoneNumber','email']"
                     [paginator]="true"
                     [rowHover]="true"
                     [rows]="10" [showCurrentPageReport]="true" [value]="items"
                     currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                     dataKey="id"
                     styleClass="p-datatable-customers">
                <ng-template pTemplate="caption">
                    <div class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between table-header">
                        <div class="p-col"><h5 class="p-m-0">Manage Professors</h5><br>
                            <span>
                        <input [(ngModel)]="prof.nom  " pInputText placeholder="Search by LastName"
                               style="margin-right: 10px;width: 200px"
                               type="text"/>
                        <input [(ngModel)]="prof.prenom  " pInputText placeholder="Search by FirstName"
                               style="margin-right: 10px;width: 200px"
                               type="text"/>
                        <input [(ngModel)]="prof.username  " pInputText placeholder="Search by UserName"
                               style="margin-right: 10px;width: 200px"
                               type="text"/>

              <button pButton pRipple type="button" icon="pi pi-search" (click)="findByCriteria()"
                      style="margin-left: 25px"
                      class="p-button-rounded p-button-success"></button>

                        </span></div>
                    </div>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 3rem">
                            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th pSortableColumn="firstName"> Name
                            <p-sortIcon field="firstName"></p-sortIcon>
                        </th>
                        <th pSortableColumn="phoneNumber">Phone Number
                            <p-sortIcon field="phoneNumber"></p-sortIcon>
                        </th>
                        <th pSortableColumn="email">Email
                            <p-sortIcon field="email"></p-sortIcon>
                        </th>
                        <th pSortableColumn="City">Action
                        </th>

                    </tr>
                </ng-template>
                <ng-template let-professor pTemplate="body">
                    <tr>
                        <td>
                            <p-tableCheckbox [value]="professor"></p-tableCheckbox>
                        </td>
                        <td>{{professor?.prenom}} {{ professor?.nom}}</td>
                        <td>{{professor?.numero}}</td>
                        <td>{{professor?.username}}</td>
                        <td>
                            <button (click)="edit(professor); findByProfId(professor)"
                                    class="p-button-rounded p-button-success p-mr-2" icon="pi pi-pencil" pButton
                                    pRipple></button>
                            <button (click)="view(professor) ; findByProfId(professor)"
                                    class="p-button-rounded p-button-info p-mr-2" icon="pi pi-list" pButton
                                    pRipple></button>
                            <button (click)="delete(professor)" class="p-button-rounded p-button-danger p-mr-2"
                                    icon="pi pi-trash" pButton
                                    pRipple></button>
                            <button (click)="viewSession(professor)" class="p-button-rounded p-button-sm p-mr-2"
                                    icon="pi pi-book" pButton
                                    pRipple></button>
                            <button pButton pRipple type="button" icon="pi pi-calendar"
                                    (click)="showScheduleDialog(professor)"
                                    class="p-button-rounded p-button-secondary"></button>
                        </td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="summary">
                    <div class="p-d-flex p-ai-center p-jc-between">
                        In total there are {{items ? items.length : 0 }} items.
                    </div>
                </ng-template>
            </p-table>
        </div>

        <app-professeur-create></app-professeur-create>
        <app-professeur-edit></app-professeur-edit>
        <app-professeur-view></app-professeur-view>
        <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
    </div>
</div>

<!------------------------ Schedule dialog -------------------------------------------------->


<div [hidden]="scheduleDialog" class="p-col-md-12">
    <button pButton (click)="hideDialog()" pRipple style="float:right!important; margin: 1%  2px"
            type="button" icon="pi pi-times"
            class="p-button-rounded p-button-text "></button>


    <!--    <ejs-schedule width='100%' #scheduleObj  [selectedDate]="selectedDate" [readonly]="true"-->
    <!--                  [eventSettings]="eventSettings ">-->
    <!--        <e-views>-->
    <!--            <e-view option="Week" startHour="07:00" [timeScale]='timeScale'></e-view>-->
    <!--            <e-view option="WorkWeek" startHour="07:00" [timeScale]='timeScale'></e-view>-->
    <!--            <e-view option="Month" [showWeekend]="showWeekend" [timeScale]='timeScale'></e-view>-->
    <!--        </e-views>-->
    <!--    </ejs-schedule>-->
    <table style="padding: 0 22px 10px 0;float: left;" class="property-table">
        <tbody>
        <tr>
            <td style="width: 80%;">
                <div>
                    <ejs-dropdownlist width='250px' id='scheduletimezone' #timezoneDropdown
                                      [dataSource]='timezoneData'
                                      (change)='onTimezoneDropDownChange($event)' [value]='dropDownValue'
                                      [allowFiltering]="true"
                                      [fields]='fields'
                                      popupWidth='250'></ejs-dropdownlist>
                </div>
            </td>
        </tr>
        </tbody>
    </table>

    <ejs-schedule #scheduleObj cssClass='schedule-group-custom-work-days' width='100%'
                  [currentView]="currentView" [group]="group" [selectedDate]="selectedDate"
                  (actionComplete)="onActionComplete($event)"
                  (popupOpen)="onPopupOpen($event)"
                  [eventSettings]="eventSettings"
                  [allowDragAndDrop]="allowDragDrop">
        <ng-template #resourceHeaderTemplate let-data>
            <div class='template-wrap'>
                <!--                <div class="resource-image {{getDoctorImage(data)}}"></div>-->
                <div class="resource-details">
                    <!--                    <div class="resource-name">{{getDoctorName(data)}}</div>-->
                    <!--                    <div class="resource-designation">{{getDoctorLevel(data)}}</div>-->
                </div>
            </div>
        </ng-template>
        <e-views>
            <e-view option="Week" [timeScale]='timeScale'></e-view>
            <e-view option="WorkWeek" [timeScale]='timeScale'></e-view>
            <e-view option="Month" [timeScale]='timeScale'></e-view>
        </e-views>
        <e-resources>
            <e-resource field='DoctorId' title='text' name='Profs' [dataSource]='resourceDataSource'
                        textField='subject'>
            </e-resource>
<!--            <e-resource field='id' title='grpName' name='grpName' [dataSource]='scheduleProfs'-->
<!--                        textField='grpName'-->
<!--                        idField='id' colorField='#68c671'>-->
<!--            </e-resource>-->
        </e-resources>


        <!--     Header template -->
        <ng-template #quickInfoTemplatesHeader>
            <div>
                <div class="e-popup-header">
                    <div class="e-header-icon-wrapper">
                        <button class="e-edit e-control e-btn e-lib e-flat e-round e-small e-icon-btn" title="Edit"
                                (click)="onEditClick()">
                        </button>
                        <button class=" e-control e-btn e-lib e-flat e-round delete-btn e-small e-icon-btn"
                                title="Delete"
                                (click)="showDialog()">
                            <span class="e-btn-icon e-icons e-delete-icon"></span>
                        </button>
                        <button class="e-close e-control e-btn e-lib e-flat e-round e-small e-icon-btn"
                                title="Close"
                                (click)="onCloseClick()">
                        </button>
                    </div>
                </div>

            </div>
            <div *ngIf="scheduleProf.id !== 0" class="quick-info-content">
                <div class="event-content">
                    <div class="meeting-type-wrap">
                        <span>{{scheduleProf?.subject}}</span>
                    </div>

                    <div style="border-top: 2px solid #3f51b5;" class="e-resource-details e-text-ellipsis"><i
                            style="margin-right: 4%;color: #757575;"
                            class="pi pi-user"></i>
                        {{scheduleProf.prof.prenom }} {{ scheduleProf.prof.nom }}</div>

                    <div style="margin-top: 17px;" class="e-resource-details e-text-ellipsis"><i
                            style="margin-right: 4%;color: #757575;"
                            class="pi pi-users"></i>
                        {{scheduleProf.grpName}}</div>

                </div>
            </div>

        </ng-template>


        <ng-template #quickInfoTemplatesFooter let-data>
            <div *ngIf="data.elementType == 'cell'" class="e-cell-footer">
                <div class="left-button">
                    <button class="e-event-details" title="Extra Details" (click)="onDetailsClick(editorTemplate)">
                        More
                        Details
                    </button>
                </div>
            </div>
        </ng-template>


        <ng-template #editorTemplate pTemplate="content editorTemplate">

            <div class="p-field">
                <label>Teacher Name </label>
                <p-dropdown (click)="getProf()" [(ngModel)]="scheduleProf.prof" [options]="professors"
                            class="e-field"
                            data-name="teacher"
                            optionLabel="nom" placeholder="Name of Teacher"></p-dropdown>
            </div>

            <div class="p-field">
                <label> Group name </label>
                <p-dropdown [(ngModel)]="scheduleProf.groupeEtudiant" [options]="groupeStudent"
                            optionLabel="libelle"
                            class="e-field"
                            data-name="groupeEtudiant" (ngModelChange)="getCourses(scheduleProf.groupeEtudiant)"
                            placeholder="Name of group"></p-dropdown>
            </div>


            <div class="p-field">
                <label> Subject </label>
                <p-dropdown [(ngModel)]="scheduleProf.cours" [options]="courses" optionLabel="libelle"
                            class="e-field"
                            data-name="groupeEtudiant"
                            placeholder="subject"></p-dropdown>
            </div>


            <div class="p-field">
                <label for="ref">Reference</label>
                <input [(ngModel)]="scheduleProf.ref" autofocus id="ref" pInputText required type="text"
                       class="e-field"
                       data-name="reference"/>
                <small *ngIf="submitted && !scheduleProf.ref" class="p-invalid">ref is required.</small>
            </div>

            <div class="p-field">
                <label for="start">Debut Date</label>
                <p-calendar id="start" [(ngModel)]="scheduleProf.startTime" [showTime]="true" name="StartTime"
                            class="e-field"
                            data-name="startTime"
                            [showIcon]="true"
                            inputId="start"></p-calendar>
                <small *ngIf="submitted && !scheduleProf.startTime" class="p-invalid">start date is
                    required.</small>
            </div>

            <div class="p-field">
                <label for="end">Finish Date </label>
                <p-calendar id="end" [(ngModel)]="scheduleProf.endTime" [showTime]="true" name="endTime"
                            class="e-field"
                            data-name="EndTime"
                            [showIcon]="true"
                            inputId="basic"></p-calendar>
                <small *ngIf="submitted && !scheduleProf.endTime" class="p-invalid">end date is required.</small>
            </div>

            <div class="p-field">
                <label> Repeat </label>
                <p-dropdown [(ngModel)]="optionSelected" [options]="repeats" optionLabel="option" class="e-field"
                            data-name="option"
                            placeholder="Repeat"></p-dropdown>
            </div>

            <div class="p-grid ">
                <div *ngIf="optionSelected.option === 'Daily' " class="p-col-7">
                    <label for="minmax">Repeat every</label>
                    <p-inputNumber [(ngModel)]="repeatNumber" [showButtons]="true" id="minmax" inputId="minmax"
                                   mode="decimal" [min]="1" [max]="100">
                    </p-inputNumber>
                    Days
                </div>
                <div *ngIf="optionSelected.option === 'Daily'" class="p-col-5">
                    <label for="icon">Until</label>
                    <p-calendar [(ngModel)]="endDate" [showIcon]="true" id="icon" inputId="icon"></p-calendar>
                </div>
            </div>

            <div class="p-grid ">
                <div class="p-col-12"></div>
                <div *ngIf=" optionSelected.option === 'Weekly'" class="p-col-12">
                    <label for="selectButton">Repeat every</label>
                    <p-selectButton id='selectButton' [options]="daysOptions" [(ngModel)]="selectedDays"
                                    multiple="multiple"
                                    optionLabel="name" optionValue="value"></p-selectButton>
                </div>
                <div *ngIf="optionSelected.option === 'Weekly'" class="p-col-12">
                    <label for="iconDay">Until</label>
                    <p-calendar [(ngModel)]="endDate" [showIcon]="true" id="iconDay" inputId="icon"></p-calendar>
                </div>
            </div>


            <div class="p-field">
                <button class="e-event-create e-text-ellipsis e-control e-btn e-lib e-flat e-primary" title="Save"
                        (click)="onCloseClick() ; save()">
                    Save
                </button>
            </div>

        </ng-template>


    </ejs-schedule>
</div>
